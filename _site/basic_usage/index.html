<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="/SimSpin/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/SimSpin/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/SimSpin/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/SimSpin/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Basic Usage | SimSpin</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Basic Usage" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A walkthrough demonstrating how to generate your first mock observation." /> <meta property="og:description" content="A walkthrough demonstrating how to generate your first mock observation." /> <link rel="canonical" href="http://localhost:4000/SimSpin/basic_usage/" /> <meta property="og:url" content="http://localhost:4000/SimSpin/basic_usage/" /> <meta property="og:site_name" content="SimSpin" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Basic Usage" /> <script type="application/ld+json"> {"description":"A walkthrough demonstrating how to generate your first mock observation.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/SimSpin/assets/images/simspin_logo.png"}},"headline":"Basic Usage","url":"http://localhost:4000/SimSpin/basic_usage/","@type":"WebPage","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/SimSpin/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/SimSpin/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="http://localhost:4000/SimSpin/installation/" class="nav-list-link">Installation</a></li><li class="nav-list-item active"><a href="http://localhost:4000/SimSpin/basic_usage/" class="nav-list-link active">Basic Usage</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/SimSpin/docs/documentation" class="nav-list-link">Documentation</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/SimSpin/docs/make_simspin_file.html" class="nav-list-link">make_simspin_file</a></li><li class="nav-list-item "><a href="http://localhost:4000/SimSpin/docs/telescope.html" class="nav-list-link">telescope</a></li><li class="nav-list-item "><a href="http://localhost:4000/SimSpin/docs/observing_strategy.html" class="nav-list-link">observing_strategy</a></li><li class="nav-list-item "><a href="http://localhost:4000/SimSpin/docs/build_datacube.html" class="nav-list-link">build_datacube</a></li><li class="nav-list-item "><a href="http://localhost:4000/SimSpin/docs/write_simspin_FITS.html" class="nav-list-link">write_simspin_fits</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/SimSpin/examples/examples" class="nav-list-link">Examples</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/SimSpin/examples/generating_hdf5.html" class="nav-list-link">HDF5 simulation format</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search SimSpin" aria-label="Search SimSpin" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/kateharborne/SimSpin" class="site-button" target="_blank" rel="noopener noreferrer" > SimSpin on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="a-walkthrough-simspins-functions"> <a href="#a-walkthrough-simspins-functions" class="anchor-heading" aria-labelledby="a-walkthrough-simspins-functions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> A walkthrough SimSpinâ€™s functions </h1> <p class="fs-5 fw-300 pb-2">Here, we demonstrate how to create your first mock observation. At each step, we take you through the simplest routine using the default parameters for each function.</p><hr /> <p class="fw-300">There are four steps to build your first SimSpin mock data cube:</p> <ol class="pb-1" id="markdown-toc"> <li><a href="#making-the-input-file" id="markdown-toc-making-the-input-file">Making the input file</a></li> <li><a href="#defining-the-observation-properties" id="markdown-toc-defining-the-observation-properties">Defining the observation properties</a> <ol> <li><a href="#telescope" id="markdown-toc-telescope">telescope</a></li> <li><a href="#observing_strategy" id="markdown-toc-observing_strategy">observing_strategy</a></li> </ol> </li> <li><a href="#generating-the-observation" id="markdown-toc-generating-the-observation">Generating the observation</a></li> <li><a href="#writing-the-output-to-fits" id="markdown-toc-writing-the-output-to-fits">Writing the output to FITS</a></li> </ol> <p class="fw-300">We take you through each of these steps in the simplest form below. More extensive examples can be found in <a href="https://kateharborne.github.io/SimSpin/examples">Examples</a>.</p><hr /> <h2 id="making-the-input-file"> <a href="#making-the-input-file" class="anchor-heading" aria-labelledby="making-the-input-file"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Making the input file </h2> <p class="fw-300">The main input for SimSpin is a galaxy simulation. This may be either an isolated galaxy model (<em>N</em>-body or hydro-dynamical) or a region cut out from a cosmological simulation.</p> <p>We define groups of particles or cells in each simulation according to the convention defined by Gadget <a href="https://ui.adsabs.harvard.edu/abs/2005MNRAS.364.1105S/abstract">(Springel, 2005)</a>:</p> <ul class="lh-tight"> <li><code class="language-plaintext highlighter-rouge">PartType0</code> - gas,</li> <li><code class="language-plaintext highlighter-rouge">PartType1</code> - dark matter,</li> <li><code class="language-plaintext highlighter-rouge">PartType2</code> - <em>N</em>-body disk,</li> <li><code class="language-plaintext highlighter-rouge">PartType3</code> - <em>N</em>-body bulge,</li> <li><code class="language-plaintext highlighter-rouge">PartType4</code> - stars,</li> <li><code class="language-plaintext highlighter-rouge">PartType5</code> - boundary/black holes.</li> </ul> <p>This information can be structured in an HDF5 file, with groups containing each of these particle types. Alternatively, SimSpin can also process Gadget binary files (SnapFormat type 1). <em>If you have any issues with your input simulation file, check out <a href="/SimSpin/examples/generating_hdf5.html">this page</a> to check your input file structure.</em></p> <p>We begin by running the <a href="https://kateharborne.github.io/SimSpin/docs/make_simspin_file"><code class="language-plaintext highlighter-rouge">make_simspin_file</code></a> function. This will organise the provided data into a consistent format for SimSpin processing and assign SEDs to stellar particles given their individual ages and metallicities.</p> <p>As this is the most time consuming process of the data-cube construction, we want to only do this once. However, a single SimSpin file can be usede multiple times for a variety of different observing strategies and telescope set ups. The variety of options available for this process is defined in the <a href="/SimSpin/docs/make_simspin_file.html">documentation here</a>.</p> <p class="fw-500 text-grey-dk-100">For this basic usage example, we will use the default parameters and one of the simple simulations included in the package:</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">simulation_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">system.file</span><span class="p">(</span><span class="s2">"extdata"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SimSpin_example_Gadget"</span><span class="p">,</span><span class="w"> 
                              </span><span class="n">package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"SimSpin"</span><span class="p">)</span><span class="w">
                              
</span><span class="n">simspin_data</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">make_simspin_file</span><span class="p">(</span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">simulation_data</span><span class="p">,</span><span class="w"> 
                                    </span><span class="n">disk_age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="c1"># ages are assigned in Gyr</span><span class="w">
                                    </span><span class="n">bulge_age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> 
                                    </span><span class="n">disk_Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.024</span><span class="p">,</span><span class="w"> </span><span class="c1"># metallicities are wrt solar </span><span class="w">
                                    </span><span class="n">bulge_Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.001</span><span class="p">,</span><span class="w">
                                    </span><span class="n">template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"BC03lr"</span><span class="p">,</span><span class="w"> </span><span class="c1"># SSP template used</span><span class="w">
                                    </span><span class="n">write_to_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> 
</span></code></pre></div></div> <p>The output of this function will be a list that can either be written to an Rdata file or written to an environment variable within your R session. In the case above, we assign the output to the environment variable <code class="language-plaintext highlighter-rouge">simspin_data</code>.</p> <p>Despite accepting a variety of different simulation inputs, the output of the <code class="language-plaintext highlighter-rouge">make_simspin_file</code> function will always be the same. The format will be a list containing 5 elements:</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="n">simspin_file</span><span class="p">)</span><span class="w"> 
</span><span class="c1"># [1] "list"</span><span class="w">

</span><span class="n">summary</span><span class="p">(</span><span class="n">simspin_file</span><span class="p">)</span><span class="w"> 
</span><span class="c1">#           Length Class      Mode</span><span class="w">
</span><span class="c1"># header       8   -none-     list    </span><span class="w">
</span><span class="c1"># star_part   12   data.frame list   </span><span class="w">
</span><span class="c1"># gas_part     0   -none-     NULL   </span><span class="w">
</span><span class="c1"># spectra      2   -none-     list   </span><span class="w">
</span><span class="c1"># wave       842   -none-     numeric</span><span class="w">
</span></code></pre></div></div> <p>While the length of each element may change depending on the input simulation type or observation properties requested, the element structure of the output will remain consistent.</p> <p>In this case, because the input file is an <em>N</em>-body model containing both bulge and disk particles, the resulting element <code class="language-plaintext highlighter-rouge">spectra</code> is a <code class="language-plaintext highlighter-rouge">list</code> with <em>2</em> entries (with one spectra assigned for the bulge particles and the second to the disk particles). For a hydrodynamical model, the <code class="language-plaintext highlighter-rouge">spectra</code> element may have many more entries due to the broader variety in stellar ages and metallicities, but will remain an element of mode <code class="language-plaintext highlighter-rouge">list</code>.</p> <p>Once a file has been produced for a single simulated galaxy, the same file can be used to produce any number of different observations. <em>Bear in mind that the resolution and wavelength range of the spectral templates used to generate the file need to overlap with the resolution and wavelength range of the observing telescope. You can check these parameters for a given template <a href="/SimSpin/docs/make_simspin_file.html#notes">here</a>. A <strong>WARNING</strong> will be issued by the code if these do not match.</em></p><hr /> <h2 id="defining-the-observation-properties"> <a href="#defining-the-observation-properties" class="anchor-heading" aria-labelledby="defining-the-observation-properties"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Defining the observation properties </h2> <p class="fw-300">SimSpin acts as a virtual telescope. You can choose to observe your galaxy model in a variety of different ways with any integral field unit (IFU) instrument. This requires you to set two distinct groups of properties - the properties of the instrument used to take the observation i.e. the <code class="language-plaintext highlighter-rouge">telescope</code>, and the properties of the object under scrutiny i.e. the <code class="language-plaintext highlighter-rouge">observing_strategy</code>.</p> <h3 id="telescope"> <a href="#telescope" class="anchor-heading" aria-labelledby="telescope"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> telescope </h3> <p class="fw-300">This class describes the properties of the instrument used for the observation. Several current instruments are included within the class (named by either the telescope or the survey that used them i.e. SAMI, MaNGA, CALIFA and MUSE) but you can also define your own instrument by specifying the <code class="language-plaintext highlighter-rouge">type = 'IFU'</code>.</p> <p class="fw-500 text-grey-dk-100">An example of a user defined instrument is shown below, with the default parameters specified:</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ifu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">telescope</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"IFU"</span><span class="p">,</span><span class="w"> </span><span class="c1"># other options include pre-defined instruments</span><span class="w">
                </span><span class="n">fov</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="c1"># field-of-view in arcsec</span><span class="w">
                </span><span class="n">aperture_shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"circular"</span><span class="p">,</span><span class="w"> </span><span class="c1"># shape of fov</span><span class="w">
                </span><span class="n">wave_range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3700</span><span class="p">,</span><span class="m">5700</span><span class="p">),</span><span class="w"> </span><span class="c1"># given in angstroms</span><span class="w">
                </span><span class="n">wave_centre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4700</span><span class="p">,</span><span class="w"> </span><span class="c1"># central wavelength given in angstroms</span><span class="w">
                </span><span class="n">wave_res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.04</span><span class="p">,</span><span class="w"> </span><span class="c1"># wavelength resolution in angstroms</span><span class="w">
                </span><span class="n">spatial_res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="c1"># size of spatial pixels in arcsec</span><span class="w">
                </span><span class="n">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"r"</span><span class="p">,</span><span class="w"> </span><span class="c1"># filter for calc of particle luminosity</span><span class="w">
                </span><span class="n">lsf_fwhm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2.65</span><span class="p">,</span><span class="w"> </span><span class="c1"># full-width half-max of line-spread-function</span><span class="w">
                </span><span class="n">signal_to_noise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="c1"># s/n ratio per angstrom</span><span class="w">
</span></code></pre></div></div> <p>This will return a <code class="language-plaintext highlighter-rouge">list</code> that contains 11 elements. Here we have precomputed properties that will be necessary for further computation steps. The units of each returned element have been added in the final column.</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="n">ifu</span><span class="p">)</span><span class="w"> 
</span><span class="c1"># [1] "list"</span><span class="w">

</span><span class="n">summary</span><span class="p">(</span><span class="n">ifu</span><span class="p">)</span><span class="w"> 
</span><span class="c1">#                 Length Class      Mode        # Units</span><span class="w">
</span><span class="c1"># type            1      -none-     character   # describes the telescope</span><span class="w">
</span><span class="c1"># fov             1      -none-     numeric     # arcsec</span><span class="w">
</span><span class="c1"># aperture_shape  1      -none-     character   # shape of fov</span><span class="w">
</span><span class="c1"># wave_range      2      -none-     numeric     # angstrom</span><span class="w">
</span><span class="c1"># wave_centre     1      -none-     numeric     # angstrom</span><span class="w">
</span><span class="c1"># wave_res        1      -none-     numeric     # angstrom</span><span class="w">
</span><span class="c1"># spatial_res     1      -none-     numeric     # arcsec per pixel</span><span class="w">
</span><span class="c1"># filter          2      data.frame list        # filter wavelengths and response</span><span class="w">
</span><span class="c1"># lsf_fwhm        1      -none-     numeric     # angstrom </span><span class="w">
</span><span class="c1"># signal_to_noise 1      -none-     numeric     # dimensionless fraction</span><span class="w">
</span><span class="c1"># sbin            1      -none-     numeric     # number of spatial bins across fov</span><span class="w">
</span></code></pre></div></div> <h3 id="observing_strategy"> <a href="#observing_strategy" class="anchor-heading" aria-labelledby="observing_strategy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> observing_strategy </h3> <p class="fw-300">We describe the conditions of the object begin observed using this function. For example, the level of atmospheric blurring can be modified, the angle from which the object is observed can be changed and the distance at which the galaxy is projected can be adjusted.</p> <p class="fw-500 text-grey-dk-100">An example with the default parameters specified is shown here:</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">observing_strategy</span><span class="p">(</span><span class="n">dist_z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="c1"># redshift distance the galaxy is placed</span><span class="w">
                              </span><span class="n">inc_deg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">70</span><span class="p">,</span><span class="w"> </span><span class="c1"># projection (0 - face-on, 90 - edge-on)</span><span class="w">
                              </span><span class="n">twist_deg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="c1"># angle of observation (longitude)</span><span class="w">
                              </span><span class="n">pointing_kpc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">),</span><span class="w"> </span><span class="c1"># pointing of the centre of the telescope</span><span class="w">
                              </span><span class="n">blur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="c1"># whether seeing conditions are included</span><span class="w">
                              </span><span class="n">fwhm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="c1"># the fwhm of the blurring kernel in arcsec</span><span class="w">
                              </span><span class="n">psf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Gaussian"</span><span class="p">)</span><span class="w"> </span><span class="c1"># the shape of the blurring kernel</span><span class="w">
</span></code></pre></div></div> <p>This will return a <code class="language-plaintext highlighter-rouge">list</code> that contains 5 elements. If <code class="language-plaintext highlighter-rouge">blur = T</code>, an additional two elements will be included to describe the point-spread-function shape and size. Similar to the previous output, this class just stores precomputed properties relevant to the observed object that will be necessary in further processing steps. The units of each returned element are listed in the final column.</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">typeof</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w"> 
</span><span class="c1"># [1] "list"</span><span class="w">

</span><span class="n">summary</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span><span class="w">
</span><span class="c1">#           Length Class    Mode    # Units</span><span class="w">
</span><span class="c1"># distance  1      Distance S4      # either redshift distance (z), physical (Mpc) or angular (kpc per arcsec)</span><span class="w">
</span><span class="c1"># inc_deg   1      -none-   numeric # degrees</span><span class="w">
</span><span class="c1"># twist_deg 1      -none-   numeric # degrees</span><span class="w">
</span><span class="c1"># pointing  1      Pointing S4      # either physical (kpc) or angular (deg)</span><span class="w">
</span><span class="c1"># blur      1      -none-   logical # FWHM specified in arcseconds</span><span class="w">

</span></code></pre></div></div> <p>With these properties specified, we have fully described the parameters necessary to construct the observation.</p><hr /> <h2 id="generating-the-observation"> <a href="#generating-the-observation" class="anchor-heading" aria-labelledby="generating-the-observation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Generating the observation </h2> <p class="fw-300">Once the particulars of the observation have been defined, we can go ahead and make the observation. This means feeding our prepared parameters into the <code class="language-plaintext highlighter-rouge">build_datacube</code> function.</p> <p class="fw-500 text-grey-dk-100">An example is shown below.</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gadget_cube</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">build_datacube</span><span class="p">(</span><span class="n">simspin_file</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">simspin_data</span><span class="p">,</span><span class="w"> 
                             </span><span class="n">telescope</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">ifu</span><span class="p">,</span><span class="w">
                             </span><span class="n">observing_strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strategy</span><span class="p">,</span><span class="w">
                             </span><span class="n">method</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="s2">"spectral"</span><span class="p">,</span><span class="w">
                             </span><span class="n">write_fits</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <p>We choose not to write the output directly to file (<code class="language-plaintext highlighter-rouge">write_fits = F</code>) and output to a variable called <code class="language-plaintext highlighter-rouge">gadget_cube</code> instead.</p> <p>The returned variable will always be a list containing 4 elements:</p> <ol class="lh-tight"> <li>the first always being the data cube,</li> <li>followed by the observation summary,</li> <li>raw simulation images and</li> <li>mock observation images generated from collapsing the data cube.</li> </ol> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span><span class="w"> </span><span class="n">typeof</span><span class="p">(</span><span class="n">gadget_cube</span><span class="p">)</span><span class="w">
</span><span class="c1"># [1] "list"</span><span class="w">
</span><span class="o">&gt;</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">gadget_cube</span><span class="p">)</span><span class="w">
</span><span class="c1">#                 Length  Class  Mode   </span><span class="w">
</span><span class="c1"># spectral_cube   1731600 -none- numeric</span><span class="w">
</span><span class="c1"># observation          33 -none- list   </span><span class="w">
</span><span class="c1"># raw_images            3 -none- list   </span><span class="w">
</span><span class="c1"># observed_images       0 -none- NULL   </span><span class="w">
</span></code></pre></div></div> <p><strong>add text about the structure of each element in the list</strong></p> <p>The overall format of this output will be consistent. However, the names of individual elements change to reflect the variety in the requested properties specified by <a href="/SimSpin/docs/telescope.html"><code class="language-plaintext highlighter-rouge">telescope</code></a> and <a href="/SimSpin/docs/observing_strategy.html"><code class="language-plaintext highlighter-rouge">observing_strategy</code></a>.</p> <ul> <li>For example, <code class="language-plaintext highlighter-rouge">method = 'spectral'</code> will return a variable <code class="language-plaintext highlighter-rouge">spectral_cube</code> as its first element; specifying instead <code class="language-plaintext highlighter-rouge">method = 'velocity'</code> will return a <code class="language-plaintext highlighter-rouge">velocity_cube</code>.</li> <li>Similarly, if we are working in velocity mode with <code class="language-plaintext highlighter-rouge">mass_flag = T</code>, the images within the <code class="language-plaintext highlighter-rouge">raw_images</code> and <code class="language-plaintext highlighter-rouge">observed_images</code> elements will include an array called <code class="language-plaintext highlighter-rouge">mass_image</code>, rather than <code class="language-plaintext highlighter-rouge">flux_image</code>.</li> </ul><hr /> <h2 id="writing-the-output-to-fits"> <a href="#writing-the-output-to-fits" class="anchor-heading" aria-labelledby="writing-the-output-to-fits"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Writing the output to FITS </h2> <p class="fw-300">Using the <code class="language-plaintext highlighter-rouge">write_simspin_FITS</code> function, the new observation can be written to a file that can be shared or re-analysed using observational pipelines. SimSpin can write such a FITS file using the variable produced by <code class="language-plaintext highlighter-rouge">build_datacube</code>.</p> <p>A few further descriptive details are suggested as input for users of the file later on, but the function defaults to sensible suggestions.</p> <p class="fw-500 text-grey-dk-100">An example is shown in the code below.</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">write_simspin_FITS</span><span class="p">(</span><span class="n">simspin_datacube</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">gadget_cube</span><span class="p">,</span><span class="w">        </span><span class="c1"># build_datacube() output</span><span class="w">
                   </span><span class="n">output_file</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"gadget_cube.FITS"</span><span class="p">,</span><span class="w"> </span><span class="c1"># filename of output file</span><span class="w">
                   </span><span class="n">input_simspin_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">simulation_data</span><span class="p">,</span><span class="w">    </span><span class="c1"># filename of input sim     </span><span class="w">
                   </span><span class="n">object_name</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">"GalaxyID_unknown"</span><span class="p">,</span><span class="w"> </span><span class="c1"># name of observed object</span><span class="w">
                   </span><span class="n">telescope_name</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">"Telescope"</span><span class="p">,</span><span class="w">        </span><span class="c1"># name of telescope</span><span class="w">
                   </span><span class="n">instrument_name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">"IFU"</span><span class="p">,</span><span class="w">              </span><span class="c1"># name of instrument </span><span class="w">
                   </span><span class="n">observer_name</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">"Anonymous"</span><span class="p">)</span><span class="w">        </span><span class="c1"># name of the observer</span><span class="w">
</span></code></pre></div></div> <p>The output of running this code will be a FITS file written at the location specified by <code class="language-plaintext highlighter-rouge">output_file</code>. To explore this file within your R session, we suggest using the <code class="language-plaintext highlighter-rouge">HeaderExt</code> branch of the package <code class="language-plaintext highlighter-rouge">Rfits</code>, which can be downloaded <a href="https://github.com/asgr/Rfits/tree/HeaderExt">here</a>. We use the <code class="language-plaintext highlighter-rouge">Rfits_info</code> function to examine the structure of the file that has been written:</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"Rfits"</span><span class="p">)</span><span class="w">
</span><span class="n">fits_summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rfits_info</span><span class="p">(</span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gadget_cube.FITS"</span><span class="p">)</span><span class="w">
</span><span class="n">fits_summary</span><span class="o">$</span><span class="n">summary</span><span class="w">

</span><span class="c1"># [1] "SIMPLE  =                    T / file does conform to FITS standard"</span><span class="w">
</span><span class="c1"># [2] "XTENSION= 'IMAGE   '           / IMAGE extension"                   </span><span class="w">
</span></code></pre></div></div> <p>Here, we can clearly see that the file contains six HDU: a header table and a number of images. The exact number of HDU can vary depending on the type of observation made by <code class="language-plaintext highlighter-rouge">build_datacube</code>. In all cases, HDU <code class="language-plaintext highlighter-rouge">ext = 1</code> will always be the header information and HDU <code class="language-plaintext highlighter-rouge">ext = 2</code> will always be the data cube produced. In this case, for a spectral data cube there are a series of <code class="language-plaintext highlighter-rouge">raw_images</code> output into subsequent HDUs. In the case of a velocity data cube, we would also see several <code class="language-plaintext highlighter-rouge">observed_images</code> included in the output.</p> <p>The first HDU (<code class="language-plaintext highlighter-rouge">ext = 1</code>) is a header element describes the properties of the observation. This acts as a record for reproducing that identical observation again in the future. Information that is recorded in the header is listed below. These are consistent across all FITS files written using this function, regardless of variety in <code class="language-plaintext highlighter-rouge">build_datacube</code> options.</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rfits_read_header</span><span class="p">(</span><span class="s2">"~/Desktop/gadget_cube.FITS"</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="o">$</span><span class="n">header</span><span class="w">
</span><span class="c1"># [1] "SIMPLE  =                    T / file does conform to FITS standard"             </span><span class="w">
</span><span class="c1"># [2] "BITPIX  =                    8 / number of bits per data pixel"                  </span><span class="w">
</span><span class="c1"># [3] "NAXIS   =                    0 / number of data axes"                            </span><span class="w">
</span><span class="c1"># [4] "EXTEND  =                    T / FITS dataset may contain extensions"            </span><span class="w">
</span><span class="c1"># [5] "COMMENT   FITS (Flexible Image Transport System) format is defined in 'Astronomy"</span><span class="w">
</span><span class="c1"># [6] "COMMENT   and Astrophysics', volume 376, page 359; bibcode: 2001A&amp;A...376..359H" </span><span class="w">
</span><span class="c1"># [7] "ORIGIN  = 'SimSpin '           / Mock observation"                               </span><span class="w">
</span><span class="c1"># [8] "TELESCOP= 'Telescope '         / Telescope name"                                 </span><span class="w">
</span><span class="c1"># [9] "INSTRUME= 'IFU     '           / Instrument used"                                </span><span class="w">
</span><span class="c1">#[10] "RA      =                    0 / [deg] 11:41:21.1 RA (J2000) pointing"           </span><span class="w">
</span><span class="c1">#[11] "DEC     =                    0 / [deg] -01:34:59.0 DEC (J2000) pointing"         </span><span class="w">
</span><span class="c1">#[12] "EQINOX  =                 2000 / Standard FK5"                                   </span><span class="w">
</span><span class="c1">#[13] "RADECSYS= 'FK5     '           / Coordinate system"                              </span><span class="w">
</span><span class="c1">#[14] "EXPTIME =                 1320 / Integration time"                               </span><span class="w">
</span><span class="c1">#[15] "MJD-OBS =             58906.11 / Obs start"                                      </span><span class="w">
</span><span class="c1">#[16] "DATE-OBS= '2021-11-16 14:47:20' / Observing date"                                </span><span class="w">
</span><span class="c1">#[17] "UTC     =                 9654 / [s] 02:40:54.000 UTC"                           </span><span class="w">
</span><span class="c1">#[18] "LST     =             30295.18 / [s] 08:24:55.178 LST"                           </span><span class="w">
</span><span class="c1">#[19] "PI-COI  = 'UNKNOWN '           / PI-COI name."                                   </span><span class="w">
</span><span class="c1">#[20] "OBSERVER= 'Anonymous'          / Name of observer."                              </span><span class="w">
</span><span class="c1">#[21] "REDSHIFT=                  0.1 / Observed redshift."                             </span><span class="w">
</span><span class="c1">#[22] "PIPEFILE= 'gadget_cube.FITS'   / Filename of data product"                       </span><span class="w">
</span><span class="c1">#[23] "BUNIT   = 'erg/s/cm**2'        / Angstrom"                                       </span><span class="w">
</span><span class="c1">#[24] "ARCFILE = '/Users/path/Library/R/4.0/library/SimSpin/extdata/SimSpin_exampl'"</span><span class="w">
</span><span class="c1">#[25] "DATAMD5 = '4aece79473a5c88f6533382655e948bf' / MD5 checksum"                     </span><span class="w">
</span><span class="c1">#[26] "OBJECT  = 'GalaxyID_unknown'   / Original target."            </span><span class="w">

</span></code></pre></div></div> <p>Observing details such as the name of the person who ran the file, the name of the object and the redshift at which is was observed are all included in this header. Importantly, we also record the name and location of the SimSpin file from which this observation was made (denoted as <code class="language-plaintext highlighter-rouge">ARCFILE</code>), enabling files to be reproduced in the future. Similarly, the SimSpin version number is recorded within the <code class="language-plaintext highlighter-rouge">ORIGIN</code> element. Admittedly, several aspects to this header have to be invented as they do not have any physical meaning for mock observations (<code class="language-plaintext highlighter-rouge">RA</code> and <code class="language-plaintext highlighter-rouge">DEC</code>, for example), but are required for consistency with their observational counterparts. <strong>We have made these <em>invented</em> properties clear to the user by stating <code class="language-plaintext highlighter-rouge">mocked</code> in the comment of the header parameters.</strong></p> <p>Finally, we can go about reading in and working with the data cube itself. Each HDU comes along with its own header to describe the properties of the image contained i.e. the units and dimensions of the pixels. These details can be used to examine and process the data.</p> <p><strong>code demonstration of reading in the spectral data cube</strong></p> <p>Similar methodology can be used to examine both the 3-dimensional data cubes and the 2-dimensional images contained within sequential HDUs. The only difference is the number of CVAL units (three for cubes versus two for images).</p> <p><em>These steps can be used to generate a mock observation of a simulated galaxy. In this Basic Usage section, we have run the simplest recipe using the inbuilt defaults of each function. In the next section, we go into details of additional functionality that may be relevant for your work.</em></p> <hr> <footer> <p><a href="#top" id="back-to-top">Back to top</a></p> <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2022 Katherine Harborne. Distributed by an <a href="https://github.com/kateharborne/SimSpin/blob/master/LICENSE">GPLv3 license.</a></p> <div class="d-flex mt-2"> <p class="text-small text-grey-dk-000 mb-0 mr-2"> Page last modified: <span class="d-inline-block">May 30 2022 at 01:57 PM</span>. </p> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> <script src="/SimSpin/assets/copyCode.js"></script> </body> </html>
